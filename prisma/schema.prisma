// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String    @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String?   // Hashed password for email/password login
  emailVerified DateTime?
  image         String?
  isAdmin       Boolean   @default(false)
  isPrivate     Boolean   @default(false) // Hide from leaderboard and public profiles
  isVerified    Boolean   @default(false) // Verified account badge (admin-only)
  badge         String?   // Badge identifier (placeholder for now)
  accentColor   String?   @default("#FFD60A") // User's preferred accent color
  themeMode     String?   @default("dark") // Theme mode: "dark" or "light"
  bio           String?   // User's bio/about section
  bannerImage   String?   // Profile banner/header image URL
  profileTheme  String    @default("{}") // JSON object for theme customization (background, card style, font size)
  achievements  String    @default("[]") // JSON array of unlocked achievement IDs
  accounts      Account[]
  sessions      Session[]
  collections   Collection[]
  folders       Folder[]
  communityCollections CommunityCollection[]
  communityCollectionVotes CommunityCollectionVote[]
  wishlists     Wishlist[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([isPrivate]) // Index for efficient public user queries (leaderboard, profiles)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Folder {
  id          String      @id @default(cuid())
  name        String
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  parentId    String?     // For nested folders (future feature)
  parent      Folder?     @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    Folder[]    @relation("FolderHierarchy")
  collections Collection[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([userId])
  @@index([parentId])
}

model Collection {
  id                      String   @id @default(cuid())
  name                    String
  description             String?
  category                String?  // e.g., "Comics", "Books", "Cards", "Toys", etc.
  template                String?  // Template type: "comic-book", "trading-card", "book", "custom", etc.
  customFieldDefinitions   String   @default("[]") // JSON array of custom field definitions for "custom" template
  folderId                String?  // Folder this collection belongs to
  folder                  Folder?   @relation(fields: [folderId], references: [id], onDelete: SetNull)
  coverImage              String?  // URL or path to cover image
  coverImageAspectRatio   String?  // Aspect ratio for cover image (e.g., "1:1", "3:4", "9:16", "2:3")
  coverImageFit           String?  @default("cover") // Image fit mode: "cover" (fill) or "contain" (crop to fit)
  tags                    String   @default("[]") // JSON array of tags
  userId                  String
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  recommendedCollectionId String?  // ID of the recommended collection this was created from
  communityCollectionId   String?  // ID of the community collection this was created from
  lastSyncedAt            DateTime? // When this collection was last synced with the recommended collection
  shareToken              String?   @unique // Unique token for sharing
  isPublic                Boolean   @default(false) // Can be shared via link
  items                   Item[]
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([shareToken])
  @@index([userId, folderId])
  @@index([userId, category]) // Index for category filtering
  @@index([recommendedCollectionId]) // Index for recommended collection lookups
  @@index([name]) // Index for search functionality
}

model Item {
  id                String     @id @default(cuid())
  collectionId      String
  collection        Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  name              String     // e.g., "Book #1", "Issue #42"
  number            Int?       // Optional number for ordering
  isOwned           Boolean    @default(false)
  notes             String?
  image             String?    // URL or path to item image
  alternativeImages String     @default("[]") // JSON array of alternative cover image URLs
  wear              String?    // Condition/Wear status (e.g., "New", "Like New", "Good", "Fair", "Poor")
  personalRating    Int?       // Personal rating (1-5 or 1-10)
  logDate           DateTime?  // Date when item was bought, read, etc.
  customFields      String     @default("{}") // JSON object for template-specific fields
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@index([collectionId])
  @@index([collectionId, isOwned]) // Composite index for efficient owned items queries
  @@index([name]) // Index for search functionality
  @@index([isOwned]) // Index for filtering owned items
}

model RecommendedCollection {
  id                      String   @id @default(cuid())
  name                    String
  description             String?
  category                String?  // e.g., "Comics", "Books", "Cards", "Toys", etc.
  template                String?  // Template type: "comic-book", "trading-card", "book", "custom", etc.
  customFieldDefinitions   String   @default("[]") // JSON array of custom field definitions for "custom" template
  coverImage              String?  // URL or path to cover image
  coverImageFit           String?  @default("cover") // Image fit mode: "cover" (fill) or "contain" (crop to fit)
  tags                    String   @default("[]") // JSON array of tags
  isPublic                Boolean  @default(false) // Whether this collection is visible to non-admin users
  items                   RecommendedItem[]
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model RecommendedItem {
  id                      String                @id @default(cuid())
  recommendedCollectionId String
  recommendedCollection   RecommendedCollection @relation(fields: [recommendedCollectionId], references: [id], onDelete: Cascade)
  name                    String     // e.g., "Book #1", "Issue #42"
  number                  Int?       // Optional number for ordering
  notes                   String?
  image                   String?   // URL or path to item image
  customFields            String    @default("{}") // JSON object for template-specific fields
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  @@index([recommendedCollectionId])
}

model CommunityCollection {
  id                      String   @id @default(cuid())
  name                    String
  description             String?
  category                String?
  template                String?  // Template type: "comic-book", "trading-card", "book", "custom", etc.
  customFieldDefinitions   String   @default("[]") // JSON array of custom field definitions for "custom" template
  coverImage              String?  // URL or path to cover image
  coverImageFit           String?  @default("cover") // Image fit mode: "cover" (fill) or "contain" (crop to fit)
  tags                    String   @default("[]") // JSON array of tags
  userId                  String   // User who created this collection
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  items                   CommunityItem[]
  votes                   CommunityCollectionVote[]
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([userId])
}

model CommunityCollectionVote {
  id           String   @id @default(cuid())
  communityCollectionId String
  communityCollection   CommunityCollection @relation(fields: [communityCollectionId], references: [id], onDelete: Cascade)
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  voteType     String   // 'upvote' or 'downvote'
  createdAt    DateTime @default(now())

  @@unique([communityCollectionId, userId])
  @@index([communityCollectionId])
  @@index([userId])
}

model CommunityItem {
  id           String                @id @default(cuid())
  communityCollectionId String
  communityCollection   CommunityCollection @relation(fields: [communityCollectionId], references: [id], onDelete: Cascade)
  name         String     // e.g., "Book #1", "Issue #42"
  number       Int?       // Optional number for ordering
  notes        String?
  image        String?   // URL or path to item image
  customFields String    @default("{}") // JSON object for template-specific fields
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@index([communityCollectionId])
}

model Wishlist {
  id          String        @id @default(cuid())
  name        String        @default("My Wishlist")
  description String?
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  shareToken  String        @unique // Unique token for sharing
  isPublic    Boolean       @default(false)
  items       WishlistItem[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([userId])
  @@index([shareToken])
}

model WishlistItem {
  id                String   @id @default(cuid())
  wishlistId        String
  wishlist          Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)
  itemId            String?  // Reference to Item if from user's collection
  collectionId      String?  // Reference to Collection if from user's collection
  itemName          String   // Name of the item
  itemNumber        Int?     // Optional number
  itemImage         String?  // URL or path to item image
  collectionName    String?  // Name of the source collection
  notes             String?  // Additional notes
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([wishlistId])
}

